<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz Master - Firebase Quiz App</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 800px;
        width: 100%;
        padding: 40px;
        animation: slideIn 0.5s ease;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h1 {
        color: #667eea;
        text-align: center;
        margin-bottom: 30px;
        font-size: 2.5em;
      }

      .page {
        display: none;
      }

      .page.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 600;
      }

      input[type="text"],
      input[type="email"],
      input[type="password"],
      input[type="file"],
      textarea,
      select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
      }

      textarea {
        resize: vertical;
        min-height: 80px;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 14px 30px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        width: 100%;
        margin-top: 10px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: #6c757d;
        margin-top: 10px;
      }

      .btn-success {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      }

      .link-btn {
        background: none;
        color: #667eea;
        text-decoration: underline;
        cursor: pointer;
        border: none;
        font-size: 14px;
        margin-top: 15px;
        display: block;
        text-align: center;
      }

      .user-info {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .user-email {
        font-weight: 600;
        color: #667eea;
      }

      .logout-btn {
        background: #dc3545;
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        color: white;
        cursor: pointer;
        font-size: 14px;
      }

      .quiz-options {
        display: grid;
        gap: 15px;
        margin: 20px 0;
      }

      .option-label {
        display: block;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .option-label:hover {
        border-color: #667eea;
        background: #f8f9ff;
      }

      .option-label input[type="radio"] {
        margin-right: 10px;
      }

      .question-card {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 20px;
      }

      .question-text {
        font-size: 1.3em;
        color: #333;
        margin-bottom: 20px;
        font-weight: 600;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: #e0e0e0;
        border-radius: 10px;
        margin-bottom: 20px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        transition: width 0.3s ease;
      }

      .score-display {
        text-align: center;
        padding: 30px;
      }

      .score-number {
        font-size: 4em;
        color: #667eea;
        font-weight: bold;
        margin: 20px 0;
      }

      .leaderboard-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .leaderboard-table th,
      .leaderboard-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
      }

      .leaderboard-table th {
        background: #667eea;
        color: white;
        font-weight: 600;
      }

      .leaderboard-table tr:hover {
        background: #f8f9fa;
      }

      .rank-badge {
        display: inline-block;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #667eea;
        color: white;
        text-align: center;
        line-height: 30px;
        font-weight: bold;
      }

      .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #333;
        color: white;
        padding: 15px 25px;
        border-radius: 8px;
        display: none;
        z-index: 1000;
        animation: slideInRight 0.3s ease;
      }

      @keyframes slideInRight {
        from {
          transform: translateX(400px);
        }
        to {
          transform: translateX(0);
        }
      }

      .toast.success {
        background: #28a745;
      }

      .toast.error {
        background: #dc3545;
      }

      .timer {
        position: absolute;
        top: 20px;
        right: 20px;
        background: #667eea;
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
        font-weight: bold;
        font-size: 1.2em;
      }

      .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .dashboard-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 12px;
        text-align: center;
        cursor: pointer;
        transition: transform 0.3s;
      }

      .dashboard-card:hover {
        transform: translateY(-5px);
      }

      .dashboard-card h3 {
        margin-bottom: 10px;
        font-size: 1.5em;
      }

      .question-number {
        text-align: center;
        color: #667eea;
        font-weight: 600;
        margin-bottom: 15px;
      }

      .admin-form .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      @media (max-width: 768px) {
        .container {
          padding: 20px;
        }

        h1 {
          font-size: 1.8em;
        }

        .dashboard-cards {
          grid-template-columns: 1fr;
        }

        .admin-form .form-row {
          grid-template-columns: 1fr;
        }
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: #667eea;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="toast" id="toast"></div>

      <!-- Login Page -->
      <div class="page active" id="loginPage">
        <h1>üéì Quiz Master</h1>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="loginEmail" placeholder="Enter your email" />
        </div>
        <div class="form-group">
          <label>Password</label>
          <input
            type="password"
            id="loginPassword"
            placeholder="Enter your password"
          />
        </div>
        <button class="btn" onclick="login()">Login</button>
        <button class="link-btn" onclick="showPage('signupPage')">
          Don't have an account? Sign up
        </button>
      </div>

      <!-- Signup Page -->
      <div class="page" id="signupPage">
        <h1>Create Account</h1>
        <div class="form-group">
          <label>Name</label>
          <input type="text" id="signupName" placeholder="Enter your name" />
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="signupEmail" placeholder="Enter your email" />
        </div>
        <div class="form-group">
          <label>Password</label>
          <input
            type="password"
            id="signupPassword"
            placeholder="Choose a password (min 6 characters)"
          />
        </div>
        <button class="btn" onclick="signup()">Sign Up</button>
        <button class="link-btn" onclick="showPage('loginPage')">
          Already have an account? Login
        </button>
      </div>

      <!-- Dashboard -->
      <div class="page" id="dashboardPage">
        <h1>Quiz Dashboard</h1>
        <div class="user-info">
          <span class="user-email" id="userEmail"></span>
          <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
        <div class="dashboard-cards">
          <div class="dashboard-card" onclick="startQuiz()">
            <h3>üìù Start Quiz</h3>
            <p>Test your knowledge</p>
          </div>
          <div class="dashboard-card" onclick="showPage('uploadPage')">
            <h3>‚ûï Add Questions</h3>
            <p>Upload new questions</p>
          </div>
          <div class="dashboard-card" onclick="showLeaderboard()">
            <h3>üèÜ Leaderboard</h3>
            <p>View top scores</p>
          </div>
        </div>
      </div>

      <!-- Upload Questions Page -->
      <div class="page" id="uploadPage">
        <h1>Upload Question</h1>
        <div class="user-info">
          <span class="user-email" id="userEmail2"></span>
          <button class="logout-btn" onclick="showPage('dashboardPage')">
            Back to Dashboard
          </button>
        </div>
        <form class="admin-form" onsubmit="uploadQuestion(event)">
          <div class="form-group">
            <label>Category</label>
            <select id="questionCategory">
              <option value="HTML">HTML</option>
              <option value="CSS">CSS</option>
              <option value="JavaScript">JavaScript</option>
              <option value="General">General</option>
            </select>
          </div>
          <div class="form-group">
            <label>Question</label>
            <textarea
              id="questionText"
              placeholder="Enter your question"
              required
            ></textarea>
          </div>
          <div class="form-group">
            <label>Question Image (Optional)</label>
            <input type="file" id="questionImage" accept="image/*" />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Option A</label>
              <input type="text" id="optionA" placeholder="Option A" required />
            </div>
            <div class="form-group">
              <label>Option B</label>
              <input type="text" id="optionB" placeholder="Option B" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Option C</label>
              <input type="text" id="optionC" placeholder="Option C" required />
            </div>
            <div class="form-group">
              <label>Option D</label>
              <input type="text" id="optionD" placeholder="Option D" required />
            </div>
          </div>
          <div class="form-group">
            <label>Correct Answer</label>
            <select id="correctAnswer" required>
              <option value="">Select correct answer</option>
              <option value="A">Option A</option>
              <option value="B">Option B</option>
              <option value="C">Option C</option>
              <option value="D">Option D</option>
            </select>
          </div>
          <button type="submit" class="btn btn-success">Upload Question</button>
        </form>
      </div>

      <!-- Quiz Page -->
      <div class="page" id="quizPage">
        <div class="timer" id="timer">30</div>
        <h1>Quiz Time!</h1>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="question-number" id="questionNumber"></div>
        <div class="question-card">
          <div class="question-text" id="currentQuestion"></div>
          <div id="questionImageContainer"></div>
          <div class="quiz-options" id="quizOptions"></div>
        </div>
        <button class="btn" id="nextBtn" onclick="nextQuestion()">
          Next Question
        </button>
        <button class="btn btn-secondary" onclick="quitQuiz()">
          Quit Quiz
        </button>
      </div>

      <!-- Results Page -->
      <div class="page" id="resultsPage">
        <div class="score-display">
          <h1>Quiz Completed! üéâ</h1>
          <div class="score-number" id="finalScore"></div>
          <p id="scoreMessage"></p>
          <button class="btn" onclick="showLeaderboard()">
            View Leaderboard
          </button>
          <button class="btn btn-secondary" onclick="showPage('dashboardPage')">
            Back to Dashboard
          </button>
        </div>
      </div>

      <!-- Leaderboard Page -->
      <div class="page" id="leaderboardPage">
        <h1>üèÜ Leaderboard</h1>
        <div id="leaderboardContent" class="loading">
          Loading leaderboard...
        </div>
        <button class="btn btn-secondary" onclick="showPage('dashboardPage')">
          Back to Dashboard
        </button>
      </div>
    </div>

    <script>
      // Firebase Configuration - REPLACE WITH YOUR CONFIG
      // To get your config:
      // 1. Go to https://console.firebase.google.com/
      // 2. Create a new project or select existing
      // 3. Go to Project Settings > General
      // 4. Scroll to "Your apps" and click Web app
      // 5. Copy the firebaseConfig object
      const firebaseConfig = {
        apiKey: "AIzaSyASz3qjKKfBgAuewsvA15-NfaXKbqMSIS8",
        authDomain: "quiz-app-98ef4.firebaseapp.com",
        databaseURL: "https://quiz-app-98ef4-default-rtdb.firebaseio.com",
        projectId: "quiz-app-98ef4",
        storageBucket: "quiz-app-98ef4.firebasestorage.app",
        messagingSenderId: "483942046042",
        appId: "1:483942046042:web:936008d1031eb0fe403b63",
        measurementId: "G-XM1ZFZ4320",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const database = firebase.database();
      const storage = firebase.storage();

      let currentUser = null;
      let questions = [];
      let currentQuestionIndex = 0;
      let score = 0;
      let correctAnswers = 0;
      let wrongAnswers = 0;
      let answeredQuestions = {};
      let timerInterval;
      let timeLeft = 30;

      // Check authentication state
      auth.onAuthStateChanged((user) => {
        if (user) {
          currentUser = user;
          $("#userEmail, #userEmail2").text(user.email);
        } else {
          currentUser = null;
          showPage("loginPage");
        }
      });

      function showPage(pageId) {
        $(".page").removeClass("active");
        $("#" + pageId).addClass("active");
      }

      function showToast(message, type = "success") {
        const toast = $("#toast");
        toast.removeClass("success error").addClass(type);
        toast.text(message).fadeIn();
        setTimeout(() => toast.fadeOut(), 3000);
      }

      // Authentication Functions
      async function signup() {
        const name = $("#signupName").val().trim();
        const email = $("#signupEmail").val().trim();
        const password = $("#signupPassword").val();

        if (!name || !email || !password) {
          showToast("Please fill all fields", "error");
          return;
        }

        if (password.length < 6) {
          showToast("Password must be at least 6 characters", "error");
          return;
        }

        try {
          const userCredential = await auth.createUserWithEmailAndPassword(
            email,
            password
          );
          await database.ref("users/" + userCredential.user.uid).set({
            name: name,
            email: email,
            createdAt: Date.now(),
          });
          showToast("Account created successfully!");
          showPage("dashboardPage");
        } catch (error) {
          showToast(error.message, "error");
        }
      }

      async function login() {
        const email = $("#loginEmail").val().trim();
        const password = $("#loginPassword").val();

        if (!email || !password) {
          showToast("Please fill all fields", "error");
          return;
        }

        try {
          await auth.signInWithEmailAndPassword(email, password);
          showToast("Login successful!");
          showPage("dashboardPage");
        } catch (error) {
          showToast(error.message, "error");
        }
      }

      function logout() {
        auth.signOut();
        showToast("Logged out successfully");
        showPage("loginPage");
      }

      // Question Upload Function
      async function uploadQuestion(e) {
        e.preventDefault();

        const category = $("#questionCategory").val();
        const questionText = $("#questionText").val().trim();
        const optionA = $("#optionA").val().trim();
        const optionB = $("#optionB").val().trim();
        const optionC = $("#optionC").val().trim();
        const optionD = $("#optionD").val().trim();
        const correctAnswer = $("#correctAnswer").val();
        const imageFile = $("#questionImage")[0].files[0];

        if (
          !questionText ||
          !optionA ||
          !optionB ||
          !optionC ||
          !optionD ||
          !correctAnswer
        ) {
          showToast("Please fill all required fields", "error");
          return;
        }

        try {
          let imageUrl = null;

          if (imageFile) {
            const imageRef = storage.ref(
              "question-images/" + Date.now() + "_" + imageFile.name
            );
            const snapshot = await imageRef.put(imageFile);
            imageUrl = await snapshot.ref.getDownloadURL();
          }

          const questionData = {
            category: category,
            question: questionText,
            options: {
              A: optionA,
              B: optionB,
              C: optionC,
              D: optionD,
            },
            correct: correctAnswer,
            imageUrl: imageUrl,
            uploadedBy: currentUser.uid,
            uploadedAt: Date.now(),
          };

          await database.ref("questions").push(questionData);
          showToast("Question uploaded successfully!");

          // Reset form
          $("#questionText, #optionA, #optionB, #optionC, #optionD").val("");
          $("#correctAnswer").val("");
          $("#questionImage").val("");
        } catch (error) {
          showToast("Error uploading question: " + error.message, "error");
        }
      }

      // Quiz Functions
      async function startQuiz() {
        try {
          const snapshot = await database.ref("questions").once("value");
          const data = snapshot.val();

          if (!data) {
            showToast("No questions available", "error");
            return;
          }

          questions = Object.keys(data).map((key) => ({
            id: key,
            ...data[key],
          }));

          // Shuffle questions
          questions = questions.sort(() => Math.random() - 0.5);

          currentQuestionIndex = 0;
          score = 0;
          correctAnswers = 0;
          wrongAnswers = 0;
          answeredQuestions = {};

          showPage("quizPage");
          displayQuestion();
          startTimer();
        } catch (error) {
          showToast("Error loading quiz: " + error.message, "error");
        }
      }

      function displayQuestion() {
        if (currentQuestionIndex >= questions.length) {
          endQuiz();
          return;
        }

        const question = questions[currentQuestionIndex];
        const progress = ((currentQuestionIndex + 1) / questions.length) * 100;

        $("#progressFill").css("width", progress + "%");
        $("#questionNumber").text(
          `Question ${currentQuestionIndex + 1} of ${questions.length}`
        );
        $("#currentQuestion").text(question.question);

        // Display image if available
        if (question.imageUrl) {
          $("#questionImageContainer").html(
            `<img src="${question.imageUrl}" style="max-width: 100%; border-radius: 8px; margin: 15px 0;">`
          );
        } else {
          $("#questionImageContainer").html("");
        }

        let optionsHtml = "";
        ["A", "B", "C", "D"].forEach((key) => {
          optionsHtml += `
                    <label class="option-label">
                        <input type="radio" name="answer" value="${key}">
                        <span>${key}. ${question.options[key]}</span>
                    </label>
                `;
        });

        $("#quizOptions").html(optionsHtml);
        $("#nextBtn").text(
          currentQuestionIndex === questions.length - 1
            ? "Finish Quiz"
            : "Next Question"
        );

        resetTimer();
      }

      function startTimer() {
        timeLeft = 30;
        $("#timer").text(timeLeft);

        timerInterval = setInterval(() => {
          timeLeft--;
          $("#timer").text(timeLeft);

          if (timeLeft <= 0) {
            nextQuestion();
          }
        }, 1000);
      }

      function resetTimer() {
        clearInterval(timerInterval);
        startTimer();
      }

      function nextQuestion() {
        const selectedAnswer = $('input[name="answer"]:checked').val();
        const question = questions[currentQuestionIndex];

        if (!answeredQuestions[question.id]) {
          if (selectedAnswer) {
            answeredQuestions[question.id] = true;

            if (selectedAnswer === question.correct) {
              correctAnswers++;
              score += 10;
              showToast("Correct! +10 points", "success");
            } else {
              wrongAnswers++;
              showToast("Wrong answer", "error");
            }
          }
        }

        currentQuestionIndex++;

        if (currentQuestionIndex < questions.length) {
          displayQuestion();
        } else {
          endQuiz();
        }
      }

      async function endQuiz() {
        clearInterval(timerInterval);

        try {
          await database.ref("scores/" + currentUser.uid).push({
            score: score,
            correctAnswers: correctAnswers,
            wrongAnswers: wrongAnswers,
            totalQuestions: questions.length,
            email: currentUser.email,
            timestamp: Date.now(),
          });

          $("#finalScore").text(score + " / " + questions.length * 10);

          const percentage = (correctAnswers / questions.length) * 100;
          let message = "";

          if (percentage >= 80) {
            message = "üåü Excellent! You're a quiz master!";
          } else if (percentage >= 60) {
            message = "üëç Good job! Keep learning!";
          } else if (percentage >= 40) {
            message = "üìö Not bad! Practice more!";
          } else {
            message = "üí™ Keep trying! You'll improve!";
          }

          $("#scoreMessage").html(`
                    <p style="font-size: 1.2em; margin: 20px 0;">
                        Correct: ${correctAnswers} | Wrong: ${wrongAnswers}
                    </p>
                    <p style="font-size: 1.5em; color: #667eea; font-weight: bold;">${message}</p>
                `);

          showPage("resultsPage");
        } catch (error) {
          showToast("Error saving score: " + error.message, "error");
        }
      }

      function quitQuiz() {
        clearInterval(timerInterval);
        showPage("dashboardPage");
      }

      // Leaderboard Function
      async function showLeaderboard() {
        showPage("leaderboardPage");
        $("#leaderboardContent").html(
          '<div class="loading">Loading leaderboard...</div>'
        );

        try {
          const snapshot = await database.ref("scores").once("value");
          const data = snapshot.val();

          if (!data) {
            $("#leaderboardContent").html(
              '<p style="text-align: center; padding: 40px;">No scores yet. Be the first to play!</p>'
            );
            return;
          }

          let scoresArray = [];
          Object.keys(data).forEach((userId) => {
            Object.keys(data[userId]).forEach((scoreId) => {
              scoresArray.push(data[userId][scoreId]);
            });
          });

          scoresArray.sort((a, b) => b.score - a.score);
          scoresArray = scoresArray.slice(0, 10);

          let leaderboardHtml = `
                    <table class="leaderboard-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Email</th>
                                <th>Score</th>
                                <th>Correct</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

          scoresArray.forEach((entry, index) => {
            const date = new Date(entry.timestamp).toLocaleDateString();
            leaderboardHtml += `
                        <tr>
                            <td><span class="rank-badge">${
                              index + 1
                            }</span></td>
                            <td>${entry.email}</td>
                            <td><strong>${entry.score}</strong></td>
                            <td>${entry.correctAnswers}/${
              entry.totalQuestions
            }</td>
                            <td>${date}</td>
                        </tr>
                    `;
          });

          leaderboardHtml += "</tbody></table>";
          $("#leaderboardContent").html(leaderboardHtml);
        } catch (error) {
          $("#leaderboardContent").html(
            '<p style="text-align: center; color: red;">Error loading leaderboard</p>'
          );
        }
      }
    </script>
  </body>
</html>
